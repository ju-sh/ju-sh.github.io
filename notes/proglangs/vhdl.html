<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>VHDL</title>
  <link rel="stylesheet" type="text/css" href="https://ju-sh.github.io/static/css/main.css" />
</head>
<body>


<nav id="navbar">
  <a href="https://ju-sh.github.io">Home</a>
   | 
  <a href="https://ju-sh.github.io/blog/index.html">Blog</a>
   | 
  <a href="https://ju-sh.github.io/wiki/index.html">Wiki</a>
   | 
  <a href="https://ju-sh.github.io/about.html">About</a>
</nav>

<header id="title-block-header">
      <h1 class="title">VHDL</h1>
    </header>

<ul>
    </ul>




<hr/>

<main id="content-container">
<p>VHDL is:</p>
<ul>
<li>Strongly typed.</li>
<li>Case insensitive (unlike verilog).</li>
<li>Full form: VHSIC Hardware Description Language
<ul>
<li>where VHSIC is Very High Speed Integrated Circuits</li>
</ul></li>
<li>Named after the US DoD project that created it: VHSIC program</li>
</ul>
<h2 id="comments">Comments</h2>
<p>Part of a line that comes after a <code>--</code>.</p>
<h2 id="reserved-words">Reserved words</h2>
<p>Reference: <a href="https://www.seas.upenn.edu/~ese171/vhdl/keywordlist.html">https://www.seas.upenn.edu/~ese171/vhdl/keywordlist.html</a> (95 words here)</p>
<table>
<tbody>
<tr class="odd">
<td><code>abs</code></td>
<td><code>access</code></td>
<td><code>after</code></td>
<td><code>alias</code></td>
<td><code>all</code></td>
</tr>
<tr class="even">
<td><code>and</code></td>
<td><code>architecture</code></td>
<td><code>array</code></td>
<td><code>assert</code></td>
<td><code>attribute</code></td>
</tr>
<tr class="odd">
<td><code>begin</code></td>
<td><code>block</code></td>
<td><code>body</code></td>
<td><code>buffer</code></td>
<td><code>bus</code></td>
</tr>
<tr class="even">
<td><code>case</code></td>
<td><code>component</code></td>
<td><code>configuration</code></td>
<td><code>constant</code></td>
<td><code>disconnect</code></td>
</tr>
<tr class="odd">
<td><code>downto</code></td>
<td><code>else</code></td>
<td><code>elsif</code></td>
<td><code>end</code></td>
<td><code>entity</code></td>
</tr>
<tr class="even">
<td><code>exit</code></td>
<td><code>file</code></td>
<td><code>for</code></td>
<td><code>function</code></td>
<td><code>generate</code></td>
</tr>
<tr class="odd">
<td><code>generic</code></td>
<td><code>group</code></td>
<td><code>guarded</code></td>
<td><code>if</code></td>
<td><code>impure</code></td>
</tr>
<tr class="even">
<td><code>in</code></td>
<td><code>inertial</code></td>
<td><code>inout</code></td>
<td><code>is</code></td>
<td><code>label</code></td>
</tr>
<tr class="odd">
<td><code>library</code></td>
<td><code>linkage</code></td>
<td><code>literal</code></td>
<td><code>loop</code></td>
<td><code>map</code></td>
</tr>
<tr class="even">
<td><code>mod</code></td>
<td><code>nand</code></td>
<td><code>new</code></td>
<td><code>next</code></td>
<td><code>nor</code></td>
</tr>
<tr class="odd">
<td><code>not</code></td>
<td><code>null</code></td>
<td><code>of</code></td>
<td><code>on</code></td>
<td><code>open</code></td>
</tr>
<tr class="even">
<td><code>or</code></td>
<td><code>others</code></td>
<td><code>out</code></td>
<td><code>package</code></td>
<td><code>port</code></td>
</tr>
<tr class="odd">
<td><code>postponed</code></td>
<td><code>procedure</code></td>
<td><code>process</code></td>
<td><code>pure</code></td>
<td><code>range</code></td>
</tr>
<tr class="even">
<td><code>record</code></td>
<td><code>register</code></td>
<td><code>reject</code></td>
<td><code>return</code></td>
<td><code>rol</code></td>
</tr>
<tr class="odd">
<td><code>ror</code></td>
<td><code>select</code></td>
<td><code>severity</code></td>
<td><code>signal</code></td>
<td><code>shared</code></td>
</tr>
<tr class="even">
<td><code>sla</code></td>
<td><code>sli</code></td>
<td><code>sra</code></td>
<td><code>srl</code></td>
<td><code>subtype</code></td>
</tr>
<tr class="odd">
<td><code>then</code></td>
<td><code>to</code></td>
<td><code>transport</code></td>
<td><code>type</code></td>
<td><code>unaffected</code></td>
</tr>
<tr class="even">
<td><code>units</code></td>
<td><code>until</code></td>
<td><code>use</code></td>
<td><code>variable</code></td>
<td><code>wait</code></td>
</tr>
<tr class="odd">
<td><code>when</code></td>
<td><code>while</code></td>
<td><code>with</code></td>
<td><code>xnor</code></td>
<td><code>xor</code></td>
</tr>
</tbody>
</table>
<h2 id="operators">Operators</h2>
<h3 id="concatenation">Concatenation (<code>&amp;</code>)</h3>
<ul>
<li>Both operands must be of same type.</li>
<li>Like pasting together two operands.</li>
</ul>
<pre class="example"><code>-- If
a : std_logic_vector (2 downto 0)
b : std_logic_vector (1 downto 0)

-- then
a &amp; b 
-- is of type std_logic_vector (5 downto 0)
</code></pre>
<p>Ref: <a href="https://www.nandland.com/vhdl/examples/example-concatenation-operator.html"><a href="https://www.nandland.com/vhdl/examples/example-concatenation-operator.html">https://www.nandland.com/vhdl/examples/example-concatenation-operator.html</a></a></p>
<h3 id="assignment">Assignment</h3>
<dl>
<dt><code>&lt;=</code></dt>
<dd><p>assign value to a signal</p>
<ul>
<li>Takes effect in the next cycle.</li>
</ul>
</dd>
<dt><code>:=</code></dt>
<dd><p>assign value to a variable</p>
<ul>
<li>Takes effect immediately.</li>
</ul>
</dd>
</dl>
<h2 id="variables">Variables</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co">-- variable var_name : type</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>variable outvector <span class="ot">:</span> std_logic_vector (7 downto 0); </span></code></pre></div>
<h2 id="records">Records</h2>
<ul>
<li>Similar to C <code>struct</code>.</li>
<li>Often used to define new VHDL types.</li>
</ul>
<p>Syntax:</p>
<pre class="syntax"><code>type &lt;type-name&gt; is record
  &lt;attr1&gt; : &lt;type&gt;;
  &lt;attr2&gt; : &lt;type&gt;;
  ...
  &lt;attrn&gt; : &lt;type&gt;;
end record &lt;type-name&gt;;
</code></pre>
<p>Example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>type rec_typ is record</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  in_en <span class="ot">:</span> std_logic;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  data  <span class="ot">:</span> std_logic_vector (7 downto 0);</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  out_en<span class="ot">:</span> std_logic;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>end record rec_typ;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="co">-- use the record</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>constant inst_rec_type <span class="ot">:</span> rec_typ <span class="ot">:=</span> (in_en  <span class="ot">=&gt;</span> <span class="bn">&#39;0&#39;</span><span class="ot">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>                                     data   <span class="ot">=&gt;</span> <span class="bn">&#39;00001001&#39;</span><span class="ot">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>                                     out_en <span class="ot">=&gt;</span> <span class="bn">&#39;1</span>);</span></code></pre></div>
<p>Another example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>nstate <span class="ot">&lt;=</span> (oldver <span class="ot">=&gt;</span> <span class="st">&quot;00&quot;</span><span class="ot">,</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>           curst <span class="ot">=&gt;</span> <span class="bn">&#39;0&#39;</span>);</span></code></pre></div>
<h2 id="enum-type">enum type</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>type state_t is (IDLE<span class="ot">,</span> START<span class="ot">,</span> FINISH);</span></code></pre></div>
<h2 id="components">Components</h2>
<p>Code that can be reused.</p>
<p>Helps to organize the code.</p>
<p>Reference: <a href="https://openlab.citytech.cuny.edu/wang-cet4805/files/2020/02/VHDL-Components-and-Port-Maps.pdf">link (pdf)</a></p>
<h2 id="signals-vs-variables">Signals vs variables</h2>
<p><a href="https://www.nandland.com/vhdl/tips/variable-vs-signal.html">Reference</a></p>
<table>
<thead>
<tr class="header">
<th><strong>Signal</strong></th>
<th><strong>Variable</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Assign with <code>&lt;=</code></td>
<td>Assign with <code>:=</code></td>
</tr>
<tr class="even">
<td>Usable inside/outside processes</td>
<td>Usable only inside processes</td>
</tr>
<tr class="odd">
<td>Visible in many processes</td>
<td>Visible only in one process</td>
</tr>
<tr class="even">
<td>(but assigned only in one)</td>
<td></td>
</tr>
<tr class="odd">
<td>May get value only on next</td>
<td>Immediately gets value on</td>
</tr>
<tr class="even">
<td>clock on assignment (in seq circuits)</td>
<td>assignment</td>
</tr>
<tr class="odd">
<td>Easier to sythesize</td>
<td>Can be harder to synthesize</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="process">Process</h2>
<ul>
<li>A VHDL construct containing a set of actions (<strong>sequential statements</strong>) to be executed sequentially.</li>
<li>The process itself is a concurrent statement.</li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>process is</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>begin</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>  sign <span class="ot">&lt;=</span> sign <span class="ot">+</span> 1;</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>  wait for 10 ns;</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>end process;</span></code></pre></div>
<h3 id="sensitivity-list">Sensitivity list</h3>
<ul>
<li>List of signals for which a state change would cause the body of process to be executed.</li>
<li>ie, the signals that the process is 'sensitive' to.</li>
</ul>
<h2 id="others"><code>others</code></h2>
<p>We can set/reset values of a few bits of a bit-vector and then set/reset the remaining bits to some value at once using <code>others</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>bv <span class="ot">:</span> std_logic_vector (7 downto 0);</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>bv <span class="ot">&lt;=</span> (2      <span class="ot">=&gt;</span> <span class="bn">&#39;1&#39;</span><span class="ot">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>       0      <span class="ot">=&gt;</span> <span class="bn">&#39;1&#39;</span><span class="ot">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>       others <span class="ot">=&gt;</span> <span class="bn">&#39;0&#39;</span>);</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="co">-- bit 2 and 0 are set to 1 and all others to 0.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="co">-- ie, bv now has 00000101 as its value.</span></span></code></pre></div>
<h2 id="gaisler-style">Gaisler style</h2>
<p>Ref: <a href="https://www.gaisler.com/doc/vhdl2proc.pdf">link</a></p>
<ul>
<li>Consists of 2-process entities.</li>
<li>Each consists of two processes:
<ul>
<li>Combinatory logic process (ie, asynchronous)</li>
<li>Sequential logic process (deals register states)</li>
</ul></li>
</ul>
<pre><code>            Combinational
        +-----------------+
 d--→--&gt;|   q = fq(d, r)  |-------&gt; q
    +--&gt;| r_in = fr(d, r) |--→--+
    |   +-----------------+     |
  r ↑                           ↓ r_in
    |   +-----------------+     |
    +-←-|     r = r_in    |--←--+
clk---&gt;-|                 |
        +-----------------+
             Sequential
</code></pre>
<p>The sequential component merely copies the value of r<sub>in</sub> generated by the combinational process to the register at the start of the next clock cycle.</p>
<p>Consider an example of an 8 bit counter, where:</p>
<ul>
<li>load signal enabled to load data value to counter from where counting should start.</li>
<li>count signal enabled to continue counting.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">library</span> ieee;</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span>all;</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="kw">entity</span> <span class="kw">count8</span> <span class="kw">is</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  <span class="kw">port</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    clk<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic</span>;</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    d<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    q<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>  );</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a><span class="kw">end count8;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>architecture count8_arch <span class="kw">is</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>  <span class="ot">signal</span> r<span class="ot">,</span> r_in <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a><span class="kw">begin</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>  <span class="kw">comb</span><span class="ot">:</span> <span class="kw">process</span>(load<span class="ot">,</span> count<span class="ot">,</span> d<span class="ot">,</span> r) <span class="kw">is</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>    <span class="ot">variable</span> tmp <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>  <span class="kw">begin</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>    <span class="kw">if</span> load <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">then</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>      tmp <span class="ot">:=</span> d;</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a>    <span class="kw">elsif</span> count <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">then</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a>      tmp <span class="ot">:=</span> r <span class="ot">+</span> <span class="dv">1</span>;</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>    <span class="kw">else</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a>      tmp <span class="ot">:=</span> r;</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a>    <span class="kw">end if;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a>    r_in <span class="ot">&lt;=</span> tmp;</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>    q <span class="ot">&lt;=</span> r;</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>  <span class="kw">end process</span>;</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true"></a>  <span class="kw">seq</span><span class="ot">:</span> <span class="kw">process</span>(clk)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true"></a>  <span class="kw">begin</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true"></a>    <span class="kw">if</span> <span class="kw">rising_edge</span>(clk) <span class="kw">then</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true"></a>      r <span class="ot">&lt;=</span> r_in;</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true"></a>    <span class="kw">end if;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true"></a>  <span class="kw">end process</span>;</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true"></a><span class="er">end count8_arch;</span></span></code></pre></div>
<p>We can do the same using record types:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"></code></pre></div>
<h2 id="packages">Packages</h2>
<p>An example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co">-- https://www.ics.uci.edu/~jmoorkan/vhdlref/function.html</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">package</span> refpack <span class="kw">is</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>  <span class="kw">function</span> <span class="kw">parity</span> (x <span class="ot">:</span> <span class="dt">std_logic_vector</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>                  <span class="kw">return</span> <span class="dt">std_logic</span>;</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a><span class="kw">end</span> refpack;</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a><span class="kw">package</span> <span class="kw">body</span> refpack <span class="kw">is</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>  <span class="kw">function</span> <span class="kw">parity</span> (x <span class="ot">:</span> <span class="dt">std_logic_vector</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>                  <span class="kw">return</span> <span class="dt">std_logic</span> <span class="kw">is</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>  <span class="kw">begin</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>    <span class="co">-- function body</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a>  <span class="kw">end</span> parity;</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a><span class="kw">end</span> refpack;</span></code></pre></div>
<h2 id="case-switch-statement">case ('switch') statement</h2>
<p>Syntax:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>case <span class="ot">&lt;</span>expression<span class="ot">&gt;</span> is</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>  when <span class="ot">&lt;</span>const<span class="ot">&gt;</span> <span class="ot">=&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>    <span class="ot">...</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>  when <span class="ot">&lt;</span>const<span class="ot">&gt;</span> <span class="ot">=&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>     <span class="ot">...</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>end case;</span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>case a_const is</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>  when <span class="st">&quot;00&quot;</span> <span class="ot">=&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    a_var <span class="ot">:=</span> 0;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>  when <span class="st">&quot;01&quot;</span> <span class="ot">=&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    a_var <span class="ot">:=</span> 1;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>  when <span class="st">&quot;10&quot;</span> <span class="ot">=&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>    a_var <span class="ot">:=</span> 2;</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>end case;</span></code></pre></div>
<h2 id="procedure">Procedure</h2>
<ul>
<li>Like functions but doesn't <em>have to</em> return any value or can return multiple values??.</li>
</ul>
<h2 id="functions">Functions</h2>
<ul>
<li>May contain any sequential statement except signal assignment and wait.</li>
<li>Functions can have only input parameters, so the mode of args (ie, <code>out~/~in</code>) needn't be mentioned.</li>
<li>Got to return some value (otherwise use a procedure). <a href="https://stackoverflow.com/questions/53635691/does-a-vhdl-function-have-to-return-a-value">ref</a></li>
<li>Equivalent to combinatory logic. Cannot replace code containing events or delays.</li>
<li>TODO VHDL-93 functions may be declared as pure or impure.</li>
</ul>
<p>Syntax:</p>
<pre><code>function function_name (args: arg_types) ret_type is
  declarations
begin
  sequential statements
end function_name;
</code></pre>
<p>Example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="co">-- Boolean NOT</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>function cust_not (val<span class="ot">:</span> std_logic)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>                  return std_logic is</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>begin</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>  if val <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> then</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>    return <span class="bn">&#39;0&#39;</span>;</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a>  else</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>    return <span class="bn">&#39;1&#39;</span>;</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a>  end if;</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>end function cust_not;</span></code></pre></div>
<h2 id="vhdl-vs-c">VHDL vs C</h2>
<table>
<thead>
<tr class="header">
<th>VHDL</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>elsif</code></td>
<td><code>else if</code></td>
</tr>
<tr class="even">
<td><code>=</code></td>
<td><code>==</code></td>
</tr>
<tr class="odd">
<td><code>:=</code> &amp; <code>&lt;=</code></td>
<td><code>=</code></td>
</tr>
</tbody>
</table>
<h2 id="if-statement"><code>if</code> statement</h2>
<p>Example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>if load <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> then</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>  tmp <span class="ot">:=</span> r <span class="ot">+</span> 1;</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>elsif count <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> then</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>  tmp <span class="ot">:=</span> r <span class="ot">-</span> 1;</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>else</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>  tmp <span class="ot">:=</span> 1;</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>end if;</span></code></pre></div>
<h2 id="loops">Loops</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="co">-- find first set bit</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>variable vec <span class="ot">:</span> std_logic_vector(7 downto 0);</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>variable first <span class="ot">:</span> natural;</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>for i in vec<span class="bn">&#39;range</span> loop</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>  if vec(i) <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> then</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>    first <span class="ot">:=</span> i;</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>    exit;  <span class="co">-- break statement</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>  end if;</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>end loop;</span></code></pre></div>
<h2 id="std_logic_1164"><code>std_logic_1164</code></h2>
<ul>
<li>VHDL 1993 onwards.</li>
<li>Expanded in VHDL 2008</li>
<li>only logical operations are defined on these types.</li>
</ul>
<h3 id="operations">Operations</h3>
<p>Operators available in this package include:</p>
<table>
<tbody>
<tr class="odd">
<td>and</td>
<td>or</td>
<td>xor</td>
</tr>
<tr class="even">
<td>nand</td>
<td>nor</td>
<td>nxor</td>
</tr>
</tbody>
</table>
<h3 id="std_logic_vector"><code>std_logic_vector</code></h3>
<p>Like an array of <code>std_logic</code> elements.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="co">-- Vector of 8 bits in each case</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a><span class="co">-- MSB is in the beginning.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="co">-- Better use this form to avoid confusion</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>signal a <span class="ot">:</span> std_logic_vector (7 downto 0);</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a><span class="co">-- MSB is at the end.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>signal b <span class="ot">:</span> std_logic_vector (0 to 7);</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a><span class="co">-- Indexing a bitvector</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a><span class="co">-- Get 4th element of a vector</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true"></a>b(4)</span></code></pre></div>
<h4 id="extract-specific-bit-positions">Extract specific bit positions</h4>
<ul>
<li><code>vec(0)</code>: bit 0</li>
<li><code>vec(9 downto 7)</code>: bits 9,8,7</li>
<li><code>vec(1 to 3)</code>: bits 1,2,3</li>
</ul>
<p>Ref: <a href="https://community.intel.com/t5/Intel-Quartus-Prime-Software/bit-shift-and-extract/td-p/131585">link</a></p>
<h3 id="types">Types</h3>
<ul>
<li><code>U</code>: uninitialized</li>
<li><code>X</code>: forcing unknown</li>
<li><code>0</code>: forcing 0</li>
<li><code>1</code>: forcing 1</li>
<li><code>Z</code>: high impedance (tri-state)</li>
<li><code>W</code>: weak unknown</li>
<li><code>L</code>: weak 0</li>
<li><code>H</code>: weak 1</li>
<li><code>-</code>: don't care</li>
</ul>
<table>
<thead>
<tr class="header">
<th></th>
<th><strong>U</strong></th>
<th><strong>X</strong></th>
<th><strong>0</strong></th>
<th><strong>1</strong></th>
<th><strong>Z</strong></th>
<th><strong>W</strong></th>
<th><strong>L</strong></th>
<th><strong>H</strong></th>
<th><strong>-</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>U</strong></td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
</tr>
<tr class="even">
<td><strong>X</strong></td>
<td>U</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>0</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>X</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>X</td>
</tr>
<tr class="even">
<td><strong>1</strong></td>
<td>U</td>
<td>X</td>
<td>X</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>Z</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>Z</td>
<td>W</td>
<td>L</td>
<td>H</td>
<td>X</td>
</tr>
<tr class="even">
<td><strong>W</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>W</td>
<td>W</td>
<td>W</td>
<td>W</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>L</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>L</td>
<td>W</td>
<td>L</td>
<td>W</td>
<td>X</td>
</tr>
<tr class="even">
<td><strong>H</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>H</td>
<td>W</td>
<td>W</td>
<td>H</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>-</strong></td>
<td>U</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>
<p>Source: <a href="http://people.sabanciuniv.edu/erkays/el310/ch09.pdf">http://people.sabanciuniv.edu/erkays/el310/ch09.pdf</a></p>
<h4 id="explained">Explained</h4>
<ul>
<li>'Forcing' means that the the signal is driven by a circuit with a regular driving current. [1][1]</li>
<li>Only 0, 1 and <code>Z</code> find practical use in synthesis these days.</li>
</ul>
<h3 id="moore-machine">Moore machine</h3>
<h4 id="bit-vector-representation">Bit vector representation</h4>
<h2 id="numeric_std"><code>numeric_std</code></h2>
<ul>
<li>ieee.numeric<sub>std</sub></li>
<li>Provides efficient implementation of operations like <code>+</code>, <code>-</code>, comparison, etc.</li>
</ul>
<h2 id="syntax-examples">Syntax examples</h2>
<h3 id="assignment-after-a-delay">Assignment after a delay</h3>
<p>Although practically, it is quite impossible to construct a circuit with an exact delay since many factors are at play:</p>
<ul>
<li>device technology</li>
<li>routing</li>
<li>fabrication process</li>
<li>operation environment</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>y <span class="ot">&lt;=</span> a <span class="ot">+</span> b <span class="ot">+</span> 1 after 10 ns;</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="co">-- means that whenever a or b changes, the expression a+b+1 is evaluated</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a><span class="co">-- and its value is assigned to y after a delay of 10ns.</span></span></code></pre></div>
<h3 id="closed-feedback-loop-bad">Closed feedback loop (bad!)</h3>
<ul>
<li>A variable is being used to calculate its own next value.</li>
<li>Considered bad practice. Better avoided.
<ul>
<li>Because, it becomes sensitive to internal propagation delays and might lead to race condition.</li>
<li>Confuses synthesis software.</li>
<li>Complicates verification and testing.</li>
</ul></li>
<li>Presence of a closed feedback loop =&gt; circuit is no longer combinational.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>q <span class="ot">&lt;=</span> (q and (not en)) or (d and en);</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="co">-- keep value of q unchanged if en is 0.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="co">-- Otherwise use d to set q</span></span></code></pre></div>
<h3 id="conditional-assignment">Conditional assignment</h3>
<pre class="syntax"><code>signal_name &lt;= value_expr_1 when boolean_expr_1 else
               value_expr_2 when boolean_expr_2 else
               ...
               value_expr_n;
</code></pre>
<h4 id="examples">Examples</h4>
<h5 id="mux">4:1 MUX</h5>
<div class="sourceCode" id="cb23"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="kw">library</span> ieee;</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span>all;</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="kw">entity</span> <span class="kw">mux41</span> <span class="kw">is</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>  <span class="kw">port</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a>    a<span class="ot">,</span> b<span class="ot">,</span> c<span class="ot">,</span> d<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);  <span class="co">-- input lines</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a>    s<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);           <span class="co">-- select lines (2)</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a>    o<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>)           <span class="co">-- output line</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a>  );</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a><span class="kw">end mux41;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a>architecture mux41_arch <span class="kw">is</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true"></a><span class="kw">begin</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true"></a>  o <span class="ot">&lt;=</span> a <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;00&quot;</span>) else</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true"></a>       b <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;01&quot;</span>) else</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true"></a>       c <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;10&quot;</span>) else</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true"></a>       d;</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true"></a><span class="kw">end mux41_arch;</span></span></code></pre></div>
<h5 id="decoder">2:4 decoder</h5>
<table>
<thead>
<tr class="header">
<th>s0</th>
<th>s1</th>
<th>out</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>0001</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>0010</td>
</tr>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>0100</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb24"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">library</span> ieee;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span>all;</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a><span class="kw">entity</span> <span class="kw">decoder</span> <span class="kw">is</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>  <span class="kw">port</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>    s<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>    o<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">3</span> <span class="ot">downto</span> <span class="dv">0</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>  );</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a><span class="kw">end decoder;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>architecture decoder_arch <span class="kw">is</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a><span class="kw">begin</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>  o <span class="ot">&lt;=</span> <span class="st">&quot;0001&quot;</span> <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;00&quot;</span>) else</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a>       <span class="st">&quot;0010&quot;</span> <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;01&quot;</span>) else</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a>       <span class="st">&quot;0100&quot;</span> <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;10&quot;</span>) else</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a>       <span class="st">&quot;1000&quot;</span>;</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a><span class="kw">end decoder_arch;</span></span></code></pre></div>
<h5 id="priority-encoder">4:2 priority encoder</h5>
<table>
<thead>
<tr class="header">
<th>r (in)</th>
<th>code (out)</th>
<th>active (out)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1xxx</td>
<td>11</td>
<td>1</td>
</tr>
<tr class="even">
<td>01xx</td>
<td>10</td>
<td>1</td>
</tr>
<tr class="odd">
<td>001x</td>
<td>01</td>
<td>1</td>
</tr>
<tr class="even">
<td>0001</td>
<td>00</td>
<td>1</td>
</tr>
<tr class="odd">
<td>0000</td>
<td>00</td>
<td>0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb25"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="kw">library</span> ieee;</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span>all;</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a><span class="kw">entity</span> <span class="kw">prio42</span> <span class="kw">is</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>  <span class="kw">port</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>    r<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">3</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>    code<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>    active<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>  );</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a><span class="er">end piro42;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a>architecture prio42_arch <span class="kw">is</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a><span class="kw">begin</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true"></a>    code <span class="ot">&lt;=</span> <span class="st">&quot;11&quot;</span> <span class="kw">when</span> (r(<span class="dv">3</span>)<span class="ot">=</span><span class="bn">&#39;1&#39;</span>) else</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true"></a>        <span class="st">&quot;10&quot;</span> <span class="kw">when</span> (r(<span class="dv">2</span>)<span class="ot">=</span><span class="bn">&#39;1&#39;</span>) else</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true"></a>        <span class="st">&quot;01&quot;</span> <span class="kw">when</span> (r(<span class="dv">1</span>)<span class="ot">=</span><span class="bn">&#39;1&#39;</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true"></a>        <span class="st">&quot;00&quot;</span>;</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true"></a>    <span class="co">-- Not sure if the following line would&#39;ve been okay.</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true"></a>    <span class="co">-- active &lt;= &#39;0&#39; when (r=&quot;0000&quot;) else &#39;1&#39;;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true"></a>    active <span class="ot">&lt;=</span> r(<span class="dv">3</span>) <span class="kw">or</span> r(<span class="dv">2</span>) <span class="kw">or</span> r(<span class="dv">1</span>) <span class="kw">or</span> r(<span class="dv">0</span>);</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true"></a><span class="kw">end prio42_arch;</span></span></code></pre></div>
<h5 id="simple-alu">Simple ALU</h5>
<table>
<thead>
<tr class="header">
<th>ctrl</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0xx</td>
<td>src0 + 1</td>
</tr>
<tr class="even">
<td>100</td>
<td>src0 + src1</td>
</tr>
<tr class="odd">
<td>101</td>
<td>src0 - src1</td>
</tr>
<tr class="even">
<td>110</td>
<td>src0 and src1</td>
</tr>
<tr class="odd">
<td>111</td>
<td>src0 or src1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb26"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="kw">library</span> ieee;</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span>all;</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a><span class="kw">entity</span> <span class="kw">alu</span> <span class="kw">is</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>  <span class="kw">port</span>(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>    ctrl<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">2</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a>    src1<span class="ot">,</span> src0<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    result<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>  );</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a><span class="kw">end alu;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a>architecture alu_arch <span class="kw">is</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a>  <span class="ot">signal</span> sum<span class="ot">,</span> diff<span class="ot">,</span> inc<span class="ot">:</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a><span class="kw">begin</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a>  inc <span class="ot">&lt;=</span> src0 <span class="ot">+</span> <span class="dv">1</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>  ctrl <span class="ot">&lt;=</span> src0 <span class="ot">+</span> <span class="dv">1</span> <span class="kw">when</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a><span class="kw">end alu_arch;</span></span></code></pre></div>
<h2 id="terms">Terms</h2>
<ul>
<li>Delta cycle
<ul>
<li>Applicable only during simulation.</li>
<li>Doesn't affect synthesized circuit.</li>
</ul></li>
<li>Delta delay
<ul>
<li>An infinitesimaly small delay after which assignments to signals happen in VHDL by default. ie, unless a delay amount is explicitly specified.</li>
<li><a href="https://en.wikipedia.org/wiki/Delta_delay">Wikipedia</a></li>
</ul></li>
<li><code>package</code></li>
</ul>
<h2 id="compilation-and-simulation">Compilation and simulation</h2>
<p>Three phases in simulation of VHDL code:</p>
<ol>
<li>Analysis (compilation)</li>
<li>Elaboration</li>
<li>Simulation</li>
</ol>
<h3 id="analysis">Analysis</h3>
<ul>
<li>VHDL compiler is also known as an <strong>analyzer</strong>.</li>
<li>Check if code conforms to syntax and semantics. If okay, generates <strong>intermediate code</strong>.
<ul>
<li>This intermediate code can be used by simulators and synthesizers, after some processing if needed.</li>
</ul></li>
</ul>
<h3 id="elaboration">Elaboration</h3>
<ul>
<li>Converts the intermediate code generated as a result of analysis to a form that can be used by simulators.</li>
<li>A <strong>driver</strong> is created for each signal.
<ul>
<li>Each driver holds the current value and a queue of future values of the signal associated with it.</li>
</ul></li>
</ul>
<h3 id="simulation">Simulation</h3>
<ul>
<li>Consists of an <strong><strong>initialization phase</strong></strong> and the actual simulation.</li>
<li>Simulation commands accepted by the simulator control the simulation.</li>
</ul>
<h2 id="tips">Tips</h2>
<ul>
<li><code>wait</code> statement cannot appear outside <code>process</code>-es.</li>
<li><code>if</code> statements cannot appear outside <code>process</code>-es.</li>
<li>Writing test benches <em>always</em> takes more time than writing the design.</li>
</ul>
<h3 id="leave-a-component-port-disconnected">Leave a component port disconnected</h3>
<p>Ports can be left disconnected while doing <code>port map</code> on components. Use <code>open</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>ADDER2<span class="ot">:</span> HALFADD port map</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>  (B<span class="ot">=&gt;</span>Y<span class="ot">,</span>A<span class="ot">=&gt;</span>X<span class="ot">,</span>SUM<span class="ot">=&gt;</span>S<span class="ot">,</span>CARRY<span class="ot">=&gt;</span>open);</span></code></pre></div>
<p>Reference: <a href="https://www.ics.uci.edu/~jmoorkan/vhdlref/compinst.html">https://www.ics.uci.edu/~jmoorkan/vhdlref/compinst.html</a></p>
<h3 id="non-standard-packages-to-avoid">Non-standard packages to avoid</h3>
<table>
<thead>
<tr class="header">
<th>Don't use</th>
<th>Instead use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ieee.std_logic_unsigned</code></td>
<td><code>ieee.numeric_std.all</code></td>
</tr>
<tr class="even">
<td><code>ieee.std_logic_arith</code></td>
<td></td>
</tr>
</tbody>
</table>
<p><a href="https://web.archive.org/web/20120225052936/https://parallelpoints.com/node/3">See more</a></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="kw">use</span> ieee<span class="ot">.</span>numeric_std<span class="ot">.</span>all;</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="co">-- use ieee.std_logic_arith.all;</span></span></code></pre></div>
<h3 id="type-conversion-for-std_logic_vector">Type conversion for <code>std_logic_vector</code></h3>
<p><a href="https://www.bitweenie.com/listings/vhdl-type-conversion/">Reference</a> <a href="https://stackoverflow.com/questions/15914859/vhdl-how-to-add-1-to-std-logic-vector">⁴</a></p>
<pre><code>       to_integer()  +--------+   std_logic_vector()           
     +---------------| signed |-------------------+            
     |               +--------+                   |            
     |                ^      ^                    |                
     |                |      |                    |                
     |     to_signed()|      |signed()            |                
     |                |      |                    |                
     V                |      |                    V                
+---------+           |      |           +------------------+
|         |-----------+      +-----------|                  |
| integer |                              | std_logic_vector |
|         |-----------+      +-----------|                  |
+---------+           |      |           +------------------+
     ^                |      |                    ^                
     |                |      |                    |                
     |   to_unsigned()|      |unsigned()          |                
     |                |      |                    |                
     |                V      V                    |                
     |              +----------+                  |             
     +--------------| unsigned |------------------+             
       to_integer() +----------+  std_logic_vector()

&lt;------------------------&gt;  &lt;--------------------------------&gt;
   Conversion functions                Type cast
</code></pre>
<h3 id="acronyms">Acronyms</h3>
<ul>
<li>LRM: Language Reference Manual.
<ul>
<li>ie, the VHDL standard (IEEE Std 1076-2008 seems to be the latest)</li>
</ul></li>
</ul>
<h2 id="more">More</h2>
<ul>
<li>generic</li>
<li>attribute</li>
<li>scalar types</li>
<li>comparison operators</li>
<li>Linting tool:
<ul>
<li>Style checks: <code>ghdl -s --std=08 file.vhdl</code></li>
<li>Logical error checks: <a href="https://github.com/m-kru/go-hdl">https://github.com/m-kru/go-hdl</a></li>
</ul></li>
</ul>
<h2 id="glossary">Glossary</h2>
<h3 id="general">General</h3>
<dl>
<dt>ASIC</dt>
<dd>Application Specific Integrated Circuit
</dd>
</dl>
<h3 id="synthesis">Synthesis</h3>
<ul>
<li>A process by which an abstract specification of desired circuit behaviour (typically at RTL level) is turned into a design implementation using logic gates.</li>
<li>VHDL =&gt; source is compiled and mapped into an implementation technology like FPGA or ASIC.
<ul>
<li>Not all VHDL constructs are suitable for synthesis though.</li>
<li>Eg: Stuff that explicitly mention timing (like <code>wait for 10 ns</code>) are not synthesisable though they can be used during simulation.</li>
</ul></li>
</ul>
<h3 id="register-transfer-notation-rtl">Register Transfer Notation (RTL)</h3>
<h2 id="references">References</h2>
<ul>
<li><em>RTL hardware design using VHDL</em> by Pong P. Chu</li>
<li><em>Digital systems design using VHDL</em> by Charles H. Roth jr and Lizy Kurian John</li>
<li><a href="https://edg.uchicago.edu/~tang/VHDLref.pdf">IEEE standard VHDL Language reference manual (IEEE Std 1076, 2000 edition)</a></li>
</ul>
<h2 id="doubts">Doubts</h2>
<ul>
<li>if a signal appears in the sensitivity list of multiple processes, in which order will the process blocks be run?
<ul>
<li>In the case of simulation, it's implementation defined.</li>
</ul></li>
</ul>
</main>
</body>
</html>
