<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>VHDL</title>
  <style>
    body {
      max-width: 38rem;
      padding: 2rem;
      margin: auto;
      background-color: #FAF0E6;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
  </style>

</head>
<body>


<div id="header">
<a href="https://rawtext.club/~famubu">Home</a>
 | 
<a href="https://rawtext.club/~famubu/blog/index.html">Blog</a>
 | 
<a href="https://rawtext.club/~famubu/wiki/index.html">Wiki</a>
 | 
<a href="https://rawtext.club/~famubu/about.html">About</a>
</div>

<header id="title-block-header">
<h1 class="title">VHDL</h1>
</header>

<ul>
    </ul>




<div id="content-container">
<p>VHDL is:</p>
<ul>
<li>Strongly typed.</li>
<li>Case insensitive (unlike verilog).</li>
<li>Full form: VHSIC Hardware Description Language
<ul>
<li>where VHSIC is Very High Speed Integrated Circuits</li>
</ul></li>
<li>Named after the US DoD project that created it: VHSIC program</li>
</ul>
<h2 id="comments">Comments</h2>
<p>Part of a line that comes after a <code>--</code>.</p>
<h2 id="reserved-words">Reserved words</h2>
<p>Reference: <a
href="https://www.seas.upenn.edu/~ese171/vhdl/keywordlist.html">https://www.seas.upenn.edu/~ese171/vhdl/keywordlist.html</a>
(95 words here)</p>
<table>
<tbody>
<tr class="odd">
<td>abs</td>
<td>access</td>
<td>after</td>
<td>alias</td>
<td>all</td>
</tr>
<tr class="even">
<td>and</td>
<td>architecture</td>
<td>array</td>
<td>assert</td>
<td>attribute</td>
</tr>
<tr class="odd">
<td>begin</td>
<td>block</td>
<td>body</td>
<td>buffer</td>
<td>bus</td>
</tr>
<tr class="even">
<td>case</td>
<td>component</td>
<td>configuration</td>
<td>constant</td>
<td>disconnect</td>
</tr>
<tr class="odd">
<td>downto</td>
<td>else</td>
<td>elsif</td>
<td>end</td>
<td>entity</td>
</tr>
<tr class="even">
<td>exit</td>
<td>file</td>
<td>for</td>
<td>function</td>
<td>generate</td>
</tr>
<tr class="odd">
<td>generic</td>
<td>group</td>
<td>guarded</td>
<td>if</td>
<td>impure</td>
</tr>
<tr class="even">
<td>in</td>
<td>inertial</td>
<td>inout</td>
<td>is</td>
<td>label</td>
</tr>
<tr class="odd">
<td>library</td>
<td>linkage</td>
<td>literal</td>
<td>loop</td>
<td>map</td>
</tr>
<tr class="even">
<td>mod</td>
<td>nand</td>
<td>new</td>
<td>next</td>
<td>nor</td>
</tr>
<tr class="odd">
<td>not</td>
<td>null</td>
<td>of</td>
<td>on</td>
<td>open</td>
</tr>
<tr class="even">
<td>or</td>
<td>others</td>
<td>out</td>
<td>package</td>
<td>port</td>
</tr>
<tr class="odd">
<td>postponed</td>
<td>procedure</td>
<td>process</td>
<td>pure</td>
<td>range</td>
</tr>
<tr class="even">
<td>record</td>
<td>register</td>
<td>reject</td>
<td>return</td>
<td>rol</td>
</tr>
<tr class="odd">
<td>ror</td>
<td>select</td>
<td>severity</td>
<td>signal</td>
<td>shared</td>
</tr>
<tr class="even">
<td>sla</td>
<td>sli</td>
<td>sra</td>
<td>srl</td>
<td>subtype</td>
</tr>
<tr class="odd">
<td>then</td>
<td>to</td>
<td>transport</td>
<td>type</td>
<td>unaffected</td>
</tr>
<tr class="even">
<td>units</td>
<td>until</td>
<td>use</td>
<td>variable</td>
<td>wait</td>
</tr>
<tr class="odd">
<td>when</td>
<td>while</td>
<td>with</td>
<td>xnor</td>
<td>xor</td>
</tr>
</tbody>
</table>
<h2 id="operators">Operators</h2>
<h3 id="concatenation">Concatenation (<code>&amp;</code>)</h3>
<ul>
<li>Both operands must be of same type.</li>
<li>Like pasting together two operands.</li>
</ul>
<pre class="example"><code>-- If
a : std_logic_vector (2 downto 0)
b : std_logic_vector (1 downto 0)

-- then
a &amp; b 
-- is of type std_logic_vector (5 downto 0)
</code></pre>
<p>Ref: <a
href="https://www.nandland.com/vhdl/examples/example-concatenation-operator.html"><a
href="https://www.nandland.com/vhdl/examples/example-concatenation-operator.html">https://www.nandland.com/vhdl/examples/example-concatenation-operator.html</a></a></p>
<h3 id="assignment">Assignment</h3>
<dl>
<dt><code>&lt;=</code></dt>
<dd>
<p>assign value to a signal</p>
<ul>
<li>Takes effect in the next cycle.</li>
</ul>
</dd>
<dt><code>:=</code></dt>
<dd>
<p>assign value to a variable</p>
<ul>
<li>Takes effect immediately.</li>
</ul>
</dd>
</dl>
<h2 id="variables">Variables</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- variable var_name : type</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ot">variable</span> outvector <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>); </span></code></pre></div>
<h2 id="records">Records</h2>
<ul>
<li>Similar to C <code>struct</code>.</li>
<li>Often used to define new VHDL types.</li>
</ul>
<p>Syntax:</p>
<pre class="syntax"><code>type &lt;type-name&gt; is record
  &lt;attr1&gt; : &lt;type&gt;;
  &lt;attr2&gt; : &lt;type&gt;;
  ...
  &lt;attrn&gt; : &lt;type&gt;;
end record &lt;type-name&gt;;
</code></pre>
<p>Example:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">type</span> rec_typ <span class="ot">is</span> <span class="kw">record</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  in_en <span class="ot">:</span> <span class="dt">std_logic</span>;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  data  <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  out_en<span class="ot">:</span> <span class="dt">std_logic</span>;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end record rec_typ;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- use the record</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ot">constant</span> inst_rec_type <span class="ot">:</span> rec_typ <span class="ot">:=</span> (in_en  <span class="ot">=&gt;</span> <span class="bn">&#39;0&#39;</span><span class="ot">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                                     data   <span class="ot">=&gt;</span> <span class="bn">&#39;00001001&#39;</span><span class="ot">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                                     out_en <span class="ot">=&gt;</span> <span class="bn">&#39;1</span>);</span></code></pre></div>
<h2 id="components">Components</h2>
<p>Code that can be reused.</p>
<p>Helps to organize the code.</p>
<p>Reference: <a
href="https://openlab.citytech.cuny.edu/wang-cet4805/files/2020/02/VHDL-Components-and-Port-Maps.pdf">link
(pdf)</a></p>
<h2 id="signals-vs-variables">Signals vs variables</h2>
<p><a
href="https://www.nandland.com/vhdl/tips/variable-vs-signal.html">Reference</a></p>
<table>
<thead>
<tr class="header">
<th><strong>Signal</strong></th>
<th><strong>Variable</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Assign with <code>&lt;=</code></td>
<td>Assign with <code>:=</code></td>
</tr>
<tr class="even">
<td>Usable inside/outside processes</td>
<td>Usable only inside processes</td>
</tr>
<tr class="odd">
<td>Visible in many processes</td>
<td>Visible only in one process</td>
</tr>
<tr class="even">
<td>(but assigned only in one)</td>
<td></td>
</tr>
<tr class="odd">
<td>May get value only on next</td>
<td>Immediately gets value on</td>
</tr>
<tr class="even">
<td>clock on assignment (in seq circuits)</td>
<td>assignment</td>
</tr>
<tr class="odd">
<td>Easier to sythesize</td>
<td>Can be harder to synthesize</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="process">Process</h2>
<ul>
<li>A VHDL construct containing a set of actions (<strong>sequential
statements</strong>) to be executed sequentially.</li>
<li>The process itself is a concurrent statement.</li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">process</span> <span class="kw">is</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  sign <span class="ot">&lt;=</span> sign <span class="ot">+</span> <span class="dv">1</span>;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">wait</span> <span class="kw">for</span> <span class="dv">10</span> <span class="dt">ns</span>;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="kw">process</span>;</span></code></pre></div>
<h3 id="sensitivity-list">Sensitivity list</h3>
<ul>
<li>List of signals for which a state change would cause the body of
process to be executed.</li>
<li>ie, the signals that the process is 'sensitive' to.</li>
</ul>
<h2 id="others"><code>others</code></h2>
<p>We can set/reset values of a few bits of a bit-vector and then
set/reset the remaining bits to some value at once using
<code>others</code>.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bv <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bv <span class="ot">&lt;=</span> (<span class="dv">2</span>      <span class="ot">=&gt;</span> <span class="bn">&#39;1&#39;</span><span class="ot">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>       <span class="dv">0</span>      <span class="ot">=&gt;</span> <span class="bn">&#39;1&#39;</span><span class="ot">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>       <span class="ot">others</span> <span class="ot">=&gt;</span> <span class="bn">&#39;0&#39;</span>);</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- bit 2 and 0 are set to 1 and all others to 0.</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- ie, bv now has 00000101 as its value.</span></span></code></pre></div>
<h2 id="gaisler-style">Gaisler style</h2>
<p>Ref: <a href="https://www.gaisler.com/doc/vhdl2proc.pdf">link</a></p>
<ul>
<li>Consists of 2-process entities.</li>
<li>Each consists of two processes:
<ul>
<li>Combinatory logic process (ie, asynchronous)</li>
<li>Sequential logic process (deals register states)</li>
</ul></li>
</ul>
<pre><code>            Combinational
        +-----------------+
 d--→--&gt;|   q = fq(d, r)  |-------&gt; q
    +--&gt;| r_in = fr(d, r) |--→--+
    |   +-----------------+     |
  r ↑                           ↓ r_in
    |   +-----------------+     |
    +-←-|     r = r_in    |--←--+
clk---&gt;-|                 |
        +-----------------+
             Sequential
</code></pre>
<p>The sequential component merely copies the value of r<sub>in</sub>
generated by the combinational process to the register at the start of
the next clock cycle.</p>
<p>Consider an example of an 8 bit counter, where:</p>
<ul>
<li>load signal enabled to load data value to counter from where
counting should start.</li>
<li>count signal enabled to continue counting.</li>
</ul>
<div class="sourceCode" id="cb8"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">library</span> ieee;</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span><span class="kw">all</span>;</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">count8</span> <span class="kw">is</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    clk<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic</span>;</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    d<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    q<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end count8;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">count8_arch</span> <span class="kw">is</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">signal</span> r<span class="ot">,</span> r_in <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">comb</span><span class="ot">:</span> <span class="sc">process</span>(load<span class="ot">,</span> count<span class="ot">,</span> d<span class="ot">,</span> r) <span class="kw">is</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">variable</span> tmp <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">begin</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> load <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="cf">then</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      tmp <span class="ot">:=</span> d;</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elsif</span> count <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="cf">then</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>      tmp <span class="ot">:=</span> r <span class="ot">+</span> <span class="dv">1</span>;</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      tmp <span class="ot">:=</span> r;</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end if;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    r_in <span class="ot">&lt;=</span> tmp;</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;=</span> r;</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="sc">end process;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">seq</span><span class="ot">:</span> <span class="sc">process</span>(clk)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="sc">begin</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">rising_edge</span>(clk) <span class="cf">then</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>      r <span class="ot">&lt;=</span> r_in;</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end if;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="sc">end process;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="cf">end count8_arch;</span></span></code></pre></div>
<p>We can do the same using record types:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"></code></pre></div>
<h2 id="packages">Packages</h2>
<p>An example:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- https://www.ics.uci.edu/~jmoorkan/vhdlref/function.html</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">package</span> <span class="dv">refpack</span> <span class="kw">is</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">function</span> <span class="dv">parity</span> (x <span class="ot">:</span> <span class="dt">std_logic_vector</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> <span class="dt">std_logic</span>;</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end refpack;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">package</span> <span class="cf">body</span> <span class="dv">refpack</span> <span class="kw">is</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">function</span> <span class="dv">parity</span> (x <span class="ot">:</span> <span class="dt">std_logic_vector</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> <span class="dt">std_logic</span> <span class="kw">is</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">begin</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- function body</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">end parity;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="cf">end refpack;</span></span></code></pre></div>
<h2 id="case-switch-statement">case ('switch') statement</h2>
<p>Syntax:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">case</span> <span class="ot">&lt;</span>expression<span class="ot">&gt;</span> <span class="kw">is</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">when</span> <span class="ot">&lt;</span>const<span class="ot">&gt;</span> <span class="ot">=&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">...</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">when</span> <span class="ot">&lt;</span>const<span class="ot">&gt;</span> <span class="ot">=&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>     <span class="ot">...</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="kw">case</span>;</span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">case</span> a_const <span class="kw">is</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">when</span> <span class="st">&quot;00&quot;</span> <span class="ot">=&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    a_var <span class="ot">:=</span> <span class="dv">0</span>;</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">when</span> <span class="st">&quot;01&quot;</span> <span class="ot">=&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    a_var <span class="ot">:=</span> <span class="dv">1</span>;</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">when</span> <span class="st">&quot;10&quot;</span> <span class="ot">=&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    a_var <span class="ot">:=</span> <span class="dv">2</span>;</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="kw">case</span>;</span></code></pre></div>
<h2 id="procedure">Procedure</h2>
<ul>
<li>Like functions but doesn't <em>have to</em> return any value or can
return multiple values??.</li>
</ul>
<h2 id="functions">Functions</h2>
<ul>
<li>May contain any sequential statement except signal assignment and
wait.</li>
<li>Functions can have only input parameters, so the mode of args (ie,
<code>out~/~in</code>) needn't be mentioned.</li>
<li>Got to return some value (otherwise use a procedure). <a
href="https://stackoverflow.com/questions/53635691/does-a-vhdl-function-have-to-return-a-value">ref</a></li>
<li>Equivalent to combinatory logic. Cannot replace code containing
events or delays.</li>
<li>TODO VHDL-93 functions may be declared as pure or impure.</li>
</ul>
<p>Syntax:</p>
<pre><code>function function_name (args: arg_types) ret_type is
  declarations
begin
  sequential statements
end function_name;
</code></pre>
<p>Example:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Boolean NOT</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">function</span> <span class="dv">cust_not</span> (val<span class="ot">:</span> <span class="dt">std_logic</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> <span class="dt">std_logic</span> <span class="kw">is</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">begin</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> val <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="cf">then</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bn">&#39;0&#39;</span>;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bn">&#39;1&#39;</span>;</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end if;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at">end function cust_not;</span></span></code></pre></div>
<h2 id="vhdl-vs-c">VHDL vs C</h2>
<table>
<thead>
<tr class="header">
<th>VHDL</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>elsif</code></td>
<td><code>else if</code></td>
</tr>
<tr class="even">
<td><code>=</code></td>
<td><code>==</code></td>
</tr>
<tr class="odd">
<td><code>:=</code> &amp; <code>&lt;=</code></td>
<td><code>=</code></td>
</tr>
</tbody>
</table>
<h2 id="if-statement"><code>if</code> statement</h2>
<p>Example:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> load <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">then</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">:=</span> r <span class="ot">+</span> <span class="dv">1</span>;</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">elsif</span> count <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">then</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">:=</span> r <span class="ot">-</span> <span class="dv">1</span>;</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">else</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">:=</span> <span class="dv">1</span>;</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="kw">if</span>;</span></code></pre></div>
<h2 id="loops">Loops</h2>
<div class="sourceCode" id="cb16"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- find first set bit</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ot">variable</span> vec <span class="ot">:</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ot">variable</span> first <span class="ot">:</span> <span class="dt">natural</span>;</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> i <span class="kw">in</span> vec<span class="bn">&#39;range</span> loop</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> vec(i) <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">then</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    first <span class="ot">:=</span> i;</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">exit</span>;  <span class="co">-- break statement</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span> <span class="kw">if</span>;</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> loop;</span></code></pre></div>
<h2 id="std_logic_1164"><code>std_logic_1164</code></h2>
<ul>
<li>VHDL 1993 onwards.</li>
<li>Expanded in VHDL 2008</li>
<li>only logical operations are defined on these types.</li>
</ul>
<h3 id="operations">Operations</h3>
<p>Operators available in this package include:</p>
<table>
<tbody>
<tr class="odd">
<td>and</td>
<td>or</td>
<td>xor</td>
</tr>
<tr class="even">
<td>nand</td>
<td>nor</td>
<td>nxor</td>
</tr>
</tbody>
</table>
<h3 id="std_logic_vector"><code>std_logic_vector</code></h3>
<p>Like an array of <code>std_logic</code> elements.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Vector of 8 bits in each case</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- MSB is in the beginning.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Better use this form to avoid confusion</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ot">signal</span> a <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- MSB is at the end.</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="ot">signal</span> b <span class="ot">:</span> <span class="dt">std_logic_vector</span> (<span class="dv">0</span> <span class="ot">to</span> <span class="dv">7</span>);</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- Indexing a bitvector</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get 4th element of a vector</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>b(<span class="dv">4</span>)</span></code></pre></div>
<h4 id="extract-specific-bit-positions">Extract specific bit
positions</h4>
<ul>
<li><code>vec(0)</code>: bit 0</li>
<li><code>vec(9 downto 7)</code>: bits 9,8,7</li>
<li><code>vec(1 to 3)</code>: bits 1,2,3</li>
</ul>
<p>Ref: <a
href="https://community.intel.com/t5/Intel-Quartus-Prime-Software/bit-shift-and-extract/td-p/131585">link</a></p>
<h3 id="types">Types</h3>
<ul>
<li><code>U</code>: uninitialized</li>
<li><code>X</code>: forcing unknown</li>
<li><code>0</code>: forcing 0</li>
<li><code>1</code>: forcing 1</li>
<li><code>Z</code>: high impedance (tri-state)</li>
<li><code>W</code>: weak unknown</li>
<li><code>L</code>: weak 0</li>
<li><code>H</code>: weak 1</li>
<li><code>-</code>: don't care</li>
</ul>
<table>
<thead>
<tr class="header">
<th></th>
<th><strong>U</strong></th>
<th><strong>X</strong></th>
<th><strong>0</strong></th>
<th><strong>1</strong></th>
<th><strong>Z</strong></th>
<th><strong>W</strong></th>
<th><strong>L</strong></th>
<th><strong>H</strong></th>
<th><strong>-</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>U</strong></td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>U</td>
</tr>
<tr class="even">
<td><strong>X</strong></td>
<td>U</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>0</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>X</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>X</td>
</tr>
<tr class="even">
<td><strong>1</strong></td>
<td>U</td>
<td>X</td>
<td>X</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>Z</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>Z</td>
<td>W</td>
<td>L</td>
<td>H</td>
<td>X</td>
</tr>
<tr class="even">
<td><strong>W</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>W</td>
<td>W</td>
<td>W</td>
<td>W</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>L</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>L</td>
<td>W</td>
<td>L</td>
<td>W</td>
<td>X</td>
</tr>
<tr class="even">
<td><strong>H</strong></td>
<td>U</td>
<td>X</td>
<td>0</td>
<td>1</td>
<td>H</td>
<td>W</td>
<td>W</td>
<td>H</td>
<td>X</td>
</tr>
<tr class="odd">
<td><strong>-</strong></td>
<td>U</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>
<p>Source: <a
href="http://people.sabanciuniv.edu/erkays/el310/ch09.pdf">http://people.sabanciuniv.edu/erkays/el310/ch09.pdf</a></p>
<h4 id="explained">Explained</h4>
<ul>
<li>'Forcing' means that the the signal is driven by a circuit with a
regular driving current. [1][1]</li>
<li>Only 0, 1 and <code>Z</code> find practical use in synthesis these
days.</li>
</ul>
<h3 id="moore-machine">Moore machine</h3>
<h4 id="bit-vector-representation">Bit vector representation</h4>
<h2 id="numeric_std"><code>numeric_std</code></h2>
<ul>
<li>ieee.numeric<sub>std</sub></li>
<li>Provides efficient implementation of operations like <code>+</code>,
<code>-</code>, comparison, etc.</li>
</ul>
<h2 id="syntax-examples">Syntax examples</h2>
<h3 id="assignment-after-a-delay">Assignment after a delay</h3>
<p>Although practically, it is quite impossible to construct a circuit
with an exact delay since many factors are at play:</p>
<ul>
<li>device technology</li>
<li>routing</li>
<li>fabrication process</li>
<li>operation environment</li>
</ul>
<div class="sourceCode" id="cb18"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;=</span> a <span class="ot">+</span> b <span class="ot">+</span> <span class="dv">1</span> <span class="kw">after</span> <span class="dv">10</span> <span class="dt">ns</span>;</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- means that whenever a or b changes, the expression a+b+1 is evaluated</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- and its value is assigned to y after a delay of 10ns.</span></span></code></pre></div>
<h3 id="closed-feedback-loop-bad">Closed feedback loop (bad!)</h3>
<ul>
<li>A variable is being used to calculate its own next value.</li>
<li>Considered bad practice. Better avoided.
<ul>
<li>Because, it becomes sensitive to internal propagation delays and
might lead to race condition.</li>
<li>Confuses synthesis software.</li>
<li>Complicates verification and testing.</li>
</ul></li>
<li>Presence of a closed feedback loop =&gt; circuit is no longer
combinational.</li>
</ul>
<div class="sourceCode" id="cb19"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;=</span> (q <span class="kw">and</span> (<span class="kw">not</span> en)) <span class="kw">or</span> (d <span class="kw">and</span> en);</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- keep value of q unchanged if en is 0.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Otherwise use d to set q</span></span></code></pre></div>
<h3 id="conditional-assignment">Conditional assignment</h3>
<pre class="syntax"><code>signal_name &lt;= value_expr_1 when boolean_expr_1 else
               value_expr_2 when boolean_expr_2 else
               ...
               value_expr_n;
</code></pre>
<h4 id="examples">Examples</h4>
<h5 id="mux">4:1 MUX</h5>
<div class="sourceCode" id="cb21"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">library</span> ieee;</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span><span class="kw">all</span>;</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">mux41</span> <span class="kw">is</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">,</span> b<span class="ot">,</span> c<span class="ot">,</span> d<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);  <span class="co">-- input lines</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    s<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);           <span class="co">-- select lines (2)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    o<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>)           <span class="co">-- output line</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end mux41;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">mux41_arch</span> <span class="kw">is</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  o <span class="ot">&lt;=</span> a <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;00&quot;</span>) <span class="kw">else</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>       b <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;01&quot;</span>) <span class="kw">else</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>       c <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;10&quot;</span>) <span class="kw">else</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>       d;</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="cf">end mux41_arch;</span></span></code></pre></div>
<h5 id="decoder">2:4 decoder</h5>
<table>
<thead>
<tr class="header">
<th>s0</th>
<th>s1</th>
<th>out</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>0001</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>0010</td>
</tr>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>0100</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">library</span> ieee;</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span><span class="kw">all</span>;</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">decoder</span> <span class="kw">is</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    s<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    o<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">3</span> <span class="ot">downto</span> <span class="dv">0</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end decoder;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">decoder_arch</span> <span class="kw">is</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  o <span class="ot">&lt;=</span> <span class="st">&quot;0001&quot;</span> <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;00&quot;</span>) <span class="kw">else</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;0010&quot;</span> <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;01&quot;</span>) <span class="kw">else</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;0100&quot;</span> <span class="kw">when</span> (s<span class="ot">=</span><span class="st">&quot;10&quot;</span>) <span class="kw">else</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;1000&quot;</span>;</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end decoder_arch;</span></span></code></pre></div>
<h5 id="priority-encoder">4:2 priority encoder</h5>
<table>
<thead>
<tr class="header">
<th>r (in)</th>
<th>code (out)</th>
<th>active (out)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1xxx</td>
<td>11</td>
<td>1</td>
</tr>
<tr class="even">
<td>01xx</td>
<td>10</td>
<td>1</td>
</tr>
<tr class="odd">
<td>001x</td>
<td>01</td>
<td>1</td>
</tr>
<tr class="even">
<td>0001</td>
<td>00</td>
<td>1</td>
</tr>
<tr class="odd">
<td>0000</td>
<td>00</td>
<td>0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">library</span> ieee;</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span><span class="kw">all</span>;</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">prio42</span> <span class="kw">is</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    r<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">3</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    code<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    active<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="er">end piro42;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">prio42_arch</span> <span class="kw">is</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    code <span class="ot">&lt;=</span> <span class="st">&quot;11&quot;</span> <span class="kw">when</span> (r(<span class="dv">3</span>)<span class="ot">=</span><span class="bn">&#39;1&#39;</span>) <span class="kw">else</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;10&quot;</span> <span class="kw">when</span> (r(<span class="dv">2</span>)<span class="ot">=</span><span class="bn">&#39;1&#39;</span>) <span class="kw">else</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;01&quot;</span> <span class="kw">when</span> (r(<span class="dv">1</span>)<span class="ot">=</span><span class="bn">&#39;1&#39;</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;00&quot;</span>;</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Not sure if the following line would&#39;ve been okay.</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- active &lt;= &#39;0&#39; when (r=&quot;0000&quot;) else &#39;1&#39;;</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    active <span class="ot">&lt;=</span> r(<span class="dv">3</span>) <span class="kw">or</span> r(<span class="dv">2</span>) <span class="kw">or</span> r(<span class="dv">1</span>) <span class="kw">or</span> r(<span class="dv">0</span>);</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="cf">end prio42_arch;</span></span></code></pre></div>
<h5 id="simple-alu">Simple ALU</h5>
<table>
<thead>
<tr class="header">
<th>ctrl</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0xx</td>
<td>src0 + 1</td>
</tr>
<tr class="even">
<td>100</td>
<td>src0 + src1</td>
</tr>
<tr class="odd">
<td>101</td>
<td>src0 - src1</td>
</tr>
<tr class="even">
<td>110</td>
<td>src0 and src1</td>
</tr>
<tr class="odd">
<td>111</td>
<td>src0 or src1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb24"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">library</span> ieee;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ieee<span class="ot">.</span>std_logic_1164<span class="ot">.</span><span class="kw">all</span>;</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">alu</span> <span class="kw">is</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    ctrl<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">2</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    src1<span class="ot">,</span> src0<span class="ot">:</span> <span class="kw">in</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    result<span class="ot">:</span> <span class="kw">out</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end alu;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">alu_arch</span> <span class="kw">is</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">signal</span> sum<span class="ot">,</span> diff<span class="ot">,</span> inc<span class="ot">:</span> <span class="dt">std_logic_vector</span>(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  inc <span class="ot">&lt;=</span> src0 <span class="ot">+</span> <span class="dv">1</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  ctrl <span class="ot">&lt;=</span> src0 <span class="ot">+</span> <span class="dv">1</span> <span class="kw">when</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end alu_arch;</span></span></code></pre></div>
<h2 id="terms">Terms</h2>
<ul>
<li>Delta cycle
<ul>
<li>Applicable only during simulation.</li>
<li>Doesn't affect synthesized circuit.</li>
</ul></li>
<li>Delta delay
<ul>
<li>An infinitesimaly small delay after which assignments to signals
happen in VHDL by default. ie, unless a delay amount is explicitly
specified.</li>
<li><a
href="https://en.wikipedia.org/wiki/Delta_delay">Wikipedia</a></li>
</ul></li>
<li><code>package</code></li>
</ul>
<h2 id="compilation-and-simulation">Compilation and simulation</h2>
<p>Three phases in simulation of VHDL code:</p>
<ol>
<li>Analysis (compilation)</li>
<li>Elaboration</li>
<li>Simulation</li>
</ol>
<h3 id="analysis">Analysis</h3>
<ul>
<li>VHDL compiler is also known as an <strong>analyzer</strong>.</li>
<li>Check if code conforms to syntax and semantics. If okay, generates
<strong>intermediate code</strong>.
<ul>
<li>This intermediate code can be used by simulators and synthesizers,
after some processing if needed.</li>
</ul></li>
</ul>
<h3 id="elaboration">Elaboration</h3>
<ul>
<li>Converts the intermediate code generated as a result of analysis to
a form that can be used by simulators.</li>
<li>A <strong>driver</strong> is created for each signal.
<ul>
<li>Each driver holds the current value and a queue of future values of
the signal associated with it.</li>
</ul></li>
</ul>
<h3 id="simulation">Simulation</h3>
<ul>
<li>Consists of an <strong><strong>initialization
phase</strong></strong> and the actual simulation.</li>
<li>Simulation commands accepted by the simulator control the
simulation.</li>
</ul>
<h2 id="tips">Tips</h2>
<ul>
<li><code>wait</code> statement cannot appear outside
<code>process</code>-es.</li>
<li><code>if</code> statements cannot appear outside
<code>process</code>-es.</li>
<li>Writing test benches <em>always</em> takes more time than writing
the design.</li>
</ul>
<h3 id="leave-a-component-port-disconnected">Leave a component port
disconnected</h3>
<p>Ports can be left disconnected while doing <code>port map</code> on
components. Use <code>open</code>.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ADDER2<span class="ot">:</span> HALFADD <span class="kw">port</span> <span class="kw">map</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  (B<span class="ot">=&gt;</span>Y<span class="ot">,</span>A<span class="ot">=&gt;</span>X<span class="ot">,</span>SUM<span class="ot">=&gt;</span>S<span class="ot">,</span>CARRY<span class="ot">=&gt;</span><span class="kw">open</span>);</span></code></pre></div>
<p>Reference: <a
href="https://www.ics.uci.edu/~jmoorkan/vhdlref/compinst.html">https://www.ics.uci.edu/~jmoorkan/vhdlref/compinst.html</a></p>
<h3 id="non-standard-packages-to-avoid">Non-standard packages to
avoid</h3>
<table>
<thead>
<tr class="header">
<th>Don't use</th>
<th>Instead use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ieee.std_logic_unsigned</code></td>
<td><code>ieee.numeric_std.all</code></td>
</tr>
<tr class="even">
<td><code>ieee.std_logic_arith</code></td>
<td></td>
</tr>
</tbody>
</table>
<p><a
href="https://web.archive.org/web/20120225052936/https://parallelpoints.com/node/3">See
more</a></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> ieee<span class="ot">.</span>numeric_std<span class="ot">.</span><span class="kw">all</span>;</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- use ieee.std_logic_arith.all;</span></span></code></pre></div>
<h3 id="type-conversion-for-std_logic_vector">Type conversion for
<code>std_logic_vector</code></h3>
<p><a
href="https://www.bitweenie.com/listings/vhdl-type-conversion/">Reference</a>
<a
href="https://stackoverflow.com/questions/15914859/vhdl-how-to-add-1-to-std-logic-vector">⁴</a></p>
<pre><code>       to_integer()  +--------+   std_logic_vector()           
     +---------------| signed |-------------------​+            
     |               +--------+                   |            
     |                ^      ^                    |                
     |                |      |                    |                
     |     to_signed()|      |signed()            |                
     |                |      |                    |                
     V                |      |                    V                
+---------+           |      |           +------------------+
|         |-----------+      +-----------|                  |
| integer |                              | std_logic_vector |
|         |-----------+      +-----------|                  |
+---------+           |      |           +------------------+
     ^                |      |                    ^                
     |                |      |                    |                
     |   to_unsigned()|      |unsigned()          |                
     |                |      |                    |                
     |                V      V                    |                
     |              +----------+                  |             
     +--------------| unsigned |------------------​+             
       to_integer() +----------+  std_logic_vector()

&lt;------------------------&gt;  &lt;--------------------------------&gt;
   Conversion functions                Type cast
</code></pre>
<h3 id="acronyms">Acronyms</h3>
<ul>
<li>LRM: Language Reference Manual.
<ul>
<li>ie, the VHDL standard (IEEE Std 1076-2008 seems to be the
latest)</li>
</ul></li>
</ul>
<h2 id="more">More</h2>
<ul>
<li>generic</li>
<li>attribute</li>
<li>scalar types</li>
<li>comparison operators</li>
</ul>
<h2 id="glossary">Glossary</h2>
<h3 id="general">General</h3>
<dl>
<dt>ASIC</dt>
<dd>
Application Specific Integrated Circuit
</dd>
</dl>
<h3 id="synthesis">Synthesis</h3>
<ul>
<li>A process by which an abstract specification of desired circuit
behaviour (typically at RTL level) is turned into a design
implementation using logic gates.</li>
<li>VHDL =&gt; source is compiled and mapped into an implementation
technology like FPGA or ASIC.
<ul>
<li>Not all VHDL constructs are suitable for synthesis though.</li>
<li>Eg: Stuff that explicitly mention timing (like
<code>wait for 10 ns</code>) are not synthesisable though they can be
used during simulation.</li>
</ul></li>
</ul>
<h3 id="register-transfer-notation-rtl">Register Transfer Notation
(RTL)</h3>
<h2 id="references">References</h2>
<ul>
<li><em>RTL hardware design using VHDL</em> by Pong P. Chu</li>
<li><em>Digital systems design using VHDL</em> by Charles H. Roth jr and
Lizy Kurian John</li>
<li><a href="https://edg.uchicago.edu/~tang/VHDLref.pdf">IEEE standard
VHDL Language reference manual (IEEE Std 1076, 2000 edition)</a></li>
</ul>
<h2 id="doubts">Doubts</h2>
<ul>
<li>if a signal appears in the sensitivity list of multiple processes,
in which order will the process blocks be run?
<ul>
<li>In the case of simulation, it's implementation defined.</li>
</ul></li>
</ul>
</div>
</body>
</html>
